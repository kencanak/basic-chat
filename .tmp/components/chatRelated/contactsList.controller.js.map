{"version":3,"sources":["../../../client/components/chatRelated/contactsList.controller.js"],"names":[],"mappings":"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","file":"contactsList.controller.js","sourcesContent":["'use strict';\n\nclass ContactsListController {\n  constructor(Auth, $state, User, $http, $scope, socket, Message) {\n    this.$http = $http;\n    this.User = User;\n    this.Message = Message;\n    this.socket = socket.socket;\n    this.$scope = $scope;\n\n    this.Auth = Auth;\n    this.isLoggedIn = Auth.isLoggedIn;\n    this.getCurrentUser = Auth.getCurrentUser;\n    this.$state = $state;\n    this.keyword = '';\n    this.searchRes = [];\n    this.searchResTotal = 0;\n    this.totalPages = 0;\n    this.range = _.range;\n    this.currentPage = 1;\n    this.contacts = [];\n    this.currentUserContacts = this.getCurrentUser().contacts;\n\n    //probably this is the worst idea to reinit the tooltip. need to look for a proper Materialize directive\n\n    $scope.$watch(\n        \"contactsList.searchRes\",\n        function handleFooChange( newValue, oldValue ) {\n            setTimeout(function(){\n              $('.tooltipped').tooltip('remove');\n              $('.tooltipped').tooltip();\n            });\n\n        }\n    );\n\n    $scope.$watch(\n        \"contactsList.contacts\",\n        function handleFooChange( newValue, oldValue ) {\n            setTimeout(function(){\n              $('.tooltipped').tooltip('remove');\n              $('.tooltipped').tooltip();\n            });\n\n        }\n    );\n  }\n\n  $onInit(){\n    $('.modal-trigger').leanModal({\n      dismissible: false\n    });\n    $('.tooltipped').tooltip();\n\n    this.getContactsList();\n  }\n\n  getLength(obj) {\n    return Object.keys(obj).length;\n  }\n\n  getContactsList(){\n    this.contacts = [];\n    if (this.currentUserContacts && this.currentUserContacts.length > 0)\n    {\n      this.User.contactsListDetails({contacts: this.currentUserContacts}).$promise.then(response => {\n        this.contacts = response.data;\n      });\n    }\n  }\n\n  searchContacts(){\n    if (this.keyword)\n    {\n      this.User.findUserByUserName({keyword: this.keyword,\n        page: this.currentPage}).$promise.then(response => {\n        this.searchResTotal = Number(response.total);\n        this.totalPages = Math.ceil(this.searchResTotal / 5);\n        this.searchRes = response.data;\n      });\n    }\n  }\n\n  changePage(page){\n    if (page < 1 || page > this.totalPages)\n      return false;\n    this.currentPage = page;\n    this.searchContacts();\n  }\n\n  addContacts(userName){\n    var contacts = this.currentUserContacts;\n\n    if (contacts.indexOf(userName) > -1)\n      return false;\n\n    this.User.addContactsList({\n      id: this.getCurrentUser()._id, contact: userName}).$promise.then(response => {\n\n        this.grabLatestContactsList();\n        var $toastContent = $('<span>Contact added successfully</span>');\n        Materialize.toast($toastContent, 5000);\n    });\n\n  }\n\n  deleteContacts(id){\n    var contacts = this.currentUserContacts;\n    var index = contacts.indexOf(id);\n    if (index === -1)\n      return false;\n\n\n    this.User.deleteContactsList({\n      id: this.getCurrentUser()._id, contact: id}).$promise.then(response => {\n\n        this.grabLatestContactsList();\n        var $toastContent = $('<span>Contact deleted successfully</span>');\n        Materialize.toast($toastContent, 5000);\n    });\n  }\n\n  grabLatestContactsList(){\n    this.socket.emit('Update Contacts');\n    this.User.get().$promise.then(response => {\n      this.currentUserContacts = response.contacts;\n      this.getContactsList();\n    });\n  }\n\n  beginConversation(recipient){\n    $('ul.tabs').tabs('select_tab', 'chats');\n\n    //let's look for existing room ID\n    this.Message.getPrivateRoomIdByParticipant({recipient: recipient}).$promise.then(response => {\n\n        //let's get the recipient socketId\n        var roomId = this.Auth.getCurrentUser().userName + '|' + recipient;\n\n        if (response.data && response.data.roomId){\n          roomId = response.data.roomId;\n        }\n\n        //let's get the recipient socketId\n        this.socket.emit('Begin Chat', {content: \"Hi\", author: this.Auth.getCurrentUser().userName, roomId: roomId, newMessage: true});\n      });\n  }\n}\n\nangular.module('chatApp')\n  .controller('ContactsListController', ContactsListController);\n"]}