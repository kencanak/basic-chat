{"version":3,"sources":["../../../client/components/auth/auth.service.js"],"names":[],"mappings":"AAAA;;AAEA,CAAC,YAAW;;AAEZ,WAAS,WAAT,CAAqB,SAArB,EAAgC,KAAhC,EAAuC,QAAvC,EAAiD,EAAjD,EAAqD,SAArD,EAAgE,IAAhE,EAAsE,IAAtE,EAA4E;AAC1E,QAAI,SAAS,KAAK,MAAlB;AACA,QAAI,cAAc,EAAlB;AACA,QAAI,YAAY,UAAU,SAAV,IAAuB,EAAvC;;AAEA,QAAI,SAAS,GAAT,CAAa,OAAb,KAAyB,UAAU,IAAV,OAAqB,SAAlD,EAA6D;AAC3D,oBAAc,KAAK,GAAL,EAAd;AACD;;AAED,QAAI,OAAO;;;;;;;;;;AAST,WATS,uBASmB,QATnB,EAS6B;AAAA,YAA/B,QAA+B,QAA/B,QAA+B;AAAA,YAArB,QAAqB,QAArB,QAAqB;;AACpC,eAAO,MAAM,IAAN,CAAW,aAAX,EAA0B;AAC/B,oBAAU,QADqB;AAE/B,oBAAU;AAFqB,SAA1B,EAIJ,IAJI,CAIC,eAAO;AACX,mBAAS,GAAT,CAAa,OAAb,EAAsB,IAAI,IAAJ,CAAS,KAA/B;;AAGA,wBAAc,KAAK,GAAL,EAAd;AACA,iBAAO,YAAY,QAAnB;AACD,SAVI,EAWJ,IAXI,CAWC,gBAAQ;AACZ,iBAAO,QAAP,EAAiB,IAAjB,EAAuB,IAAvB;AACA,iBAAO,IAAP;AACD,SAdI,EAeJ,KAfI,CAeE,eAAO;AACZ,eAAK,MAAL;AACA,iBAAO,QAAP,EAAiB,IAAI,IAArB;AACA,iBAAO,GAAG,MAAH,CAAU,IAAI,IAAd,CAAP;AACD,SAnBI,CAAP;AAoBD,OA9BQ;;;;;;AAmCT,YAnCS,oBAmCA;AACP,iBAAS,MAAT,CAAgB,OAAhB;AACA,sBAAc,EAAd;AACD,OAtCQ;;;;;;;;;;AA+CT,gBA/CS,sBA+CE,IA/CF,EA+CQ,QA/CR,EA+CkB;AACzB,eAAO,KAAK,IAAL,CAAU,IAAV,EACL,UAAS,IAAT,EAAe;AACb,mBAAS,GAAT,CAAa,OAAb,EAAsB,KAAK,KAA3B;AACA,wBAAc,KAAK,GAAL,EAAd;AACA,iBAAO,OAAO,QAAP,EAAiB,IAAjB,EAAuB,IAAvB,CAAP;AACD,SALI,EAML,UAAS,GAAT,EAAc;AACZ,eAAK,MAAL;AACA,iBAAO,OAAO,QAAP,EAAiB,GAAjB,CAAP;AACD,SATI,EASF,QATL;AAUD,OA1DQ;;;;;;;;;;;AAoET,oBApES,0BAoEM,WApEN,EAoEmB,WApEnB,EAoEgC,QApEhC,EAoE0C;AACjD,eAAO,KAAK,cAAL,CAAoB,EAAE,IAAI,YAAY,GAAlB,EAApB,EAA6C;AAClD,uBAAa,WADqC;AAElD,uBAAa;AAFqC,SAA7C,EAGJ,YAAW;AACZ,iBAAO,OAAO,QAAP,EAAiB,IAAjB,CAAP;AACD,SALM,EAKJ,UAAS,GAAT,EAAc;AACf,iBAAO,OAAO,QAAP,EAAiB,GAAjB,CAAP;AACD,SAPM,EAOJ,QAPH;AAQD,OA7EQ;;;;;;;;;;AAsFT,oBAtFS,0BAsFM,QAtFN,EAsFgB;AACvB,YAAI,UAAU,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,iBAAO,WAAP;AACD;;AAED,YAAI,QAAS,YAAY,cAAZ,CAA2B,UAA3B,CAAD,GACV,YAAY,QADF,GACa,WADzB;AAEA,eAAO,GAAG,IAAH,CAAQ,KAAR,EACJ,IADI,CACC,gBAAQ;AACZ,iBAAO,QAAP,EAAiB,IAAjB;AACA,iBAAO,IAAP;AACD,SAJI,EAIF,YAAM;AACP,iBAAO,QAAP,EAAiB,EAAjB;AACA,iBAAO,EAAP;AACD,SAPI,CAAP;AAQD,OArGQ;;;;;;;;;;AA8GT,gBA9GS,sBA8GE,QA9GF,EA8GY;AACnB,YAAI,UAAU,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,iBAAO,YAAY,cAAZ,CAA2B,MAA3B,CAAP;AACD;;AAED,eAAO,KAAK,cAAL,CAAoB,IAApB,EACJ,IADI,CACC,gBAAQ;AACZ,cAAI,KAAK,KAAK,cAAL,CAAoB,MAApB,CAAT;AACA,iBAAO,QAAP,EAAiB,EAAjB;AACA,iBAAO,EAAP;AACD,SALI,CAAP;AAMD,OAzHQ;;;;;;;;;;;AAmIT,aAnIS,mBAmID,IAnIC,EAmIK,QAnIL,EAmIe;AACtB,YAAI,UAAU,SAAV,OAAU,CAAS,CAAT,EAAY,CAAZ,EAAe;AAC3B,iBAAO,UAAU,OAAV,CAAkB,CAAlB,KAAwB,UAAU,OAAV,CAAkB,CAAlB,CAA/B;AACD,SAFD;;AAIA,YAAI,UAAU,MAAV,GAAmB,CAAvB,EAA0B;AACxB,iBAAO,QAAQ,YAAY,IAApB,EAA0B,IAA1B,CAAP;AACD;;AAED,eAAO,KAAK,cAAL,CAAoB,IAApB,EACJ,IADI,CACC,gBAAQ;AACZ,cAAI,MAAO,KAAK,cAAL,CAAoB,MAApB,CAAD,GACR,QAAQ,KAAK,IAAb,EAAmB,IAAnB,CADQ,GACmB,KAD7B;AAEA,iBAAO,QAAP,EAAiB,GAAjB;AACA,iBAAO,GAAP;AACD,SANI,CAAP;AAOD,OAnJQ;;;;;;;;;;AA4JT,aA5JS,qBA4JC;AACR,eAAO,KAAK,OAAL,CACJ,KADI,CACE,IADF,EACQ,GAAG,MAAH,CAAU,KAAV,CAAgB,CAAC,OAAD,CAAhB,EAA2B,SAA3B,CADR,CAAP;AAED,OA/JQ;;;;;;;;AAsKT,cAtKS,sBAsKE;AACT,eAAO,SAAS,GAAT,CAAa,OAAb,CAAP;AACD;AAxKQ,KAAX;;AA2KA,WAAO,IAAP;AACD;;AAED,UAAQ,MAAR,CAAe,cAAf,EACG,OADH,CACW,MADX,EACmB,WADnB;AAGC,CA5LD","file":"auth.service.js","sourcesContent":["'use strict';\n\n(function() {\n\nfunction AuthService($location, $http, $cookies, $q, appConfig, Util, User) {\n  var safeCb = Util.safeCb;\n  var currentUser = {};\n  var userRoles = appConfig.userRoles || [];\n\n  if ($cookies.get('token') && $location.path() !== '/logout') {\n    currentUser = User.get();\n  }\n\n  var Auth = {\n\n    /**\n     * Authenticate user and save token\n     *\n     * @param  {Object}   user     - login info\n     * @param  {Function} callback - optional, function(error, user)\n     * @return {Promise}\n     */\n    login({userName, password}, callback) {\n      return $http.post('/auth/local', {\n        userName: userName,\n        password: password\n      })\n        .then(res => {\n          $cookies.put('token', res.data.token);\n\n\n          currentUser = User.get();\n          return currentUser.$promise;\n        })\n        .then(user => {\n          safeCb(callback)(null, user);\n          return user;\n        })\n        .catch(err => {\n          Auth.logout();\n          safeCb(callback)(err.data);\n          return $q.reject(err.data);\n        });\n    },\n\n    /**\n     * Delete access token and user info\n     */\n    logout() {\n      $cookies.remove('token');\n      currentUser = {};\n    },\n\n    /**\n     * Create a new user\n     *\n     * @param  {Object}   user     - user info\n     * @param  {Function} callback - optional, function(error, user)\n     * @return {Promise}\n     */\n    createUser(user, callback) {\n      return User.save(user,\n        function(data) {\n          $cookies.put('token', data.token);\n          currentUser = User.get();\n          return safeCb(callback)(null, user);\n        },\n        function(err) {\n          Auth.logout();\n          return safeCb(callback)(err);\n        }).$promise;\n    },\n\n    /**\n     * Change password\n     *\n     * @param  {String}   oldPassword\n     * @param  {String}   newPassword\n     * @param  {Function} callback    - optional, function(error, user)\n     * @return {Promise}\n     */\n    changePassword(oldPassword, newPassword, callback) {\n      return User.changePassword({ id: currentUser._id }, {\n        oldPassword: oldPassword,\n        newPassword: newPassword\n      }, function() {\n        return safeCb(callback)(null);\n      }, function(err) {\n        return safeCb(callback)(err);\n      }).$promise;\n    },\n\n    /**\n     * Gets all available info on a user\n     *   (synchronous|asynchronous)\n     *\n     * @param  {Function|*} callback - optional, funciton(user)\n     * @return {Object|Promise}\n     */\n    getCurrentUser(callback) {\n      if (arguments.length === 0) {\n        return currentUser;\n      }\n\n      var value = (currentUser.hasOwnProperty('$promise')) ?\n        currentUser.$promise : currentUser;\n      return $q.when(value)\n        .then(user => {\n          safeCb(callback)(user);\n          return user;\n        }, () => {\n          safeCb(callback)({});\n          return {};\n        });\n    },\n\n    /**\n     * Check if a user is logged in\n     *   (synchronous|asynchronous)\n     *\n     * @param  {Function|*} callback - optional, function(is)\n     * @return {Bool|Promise}\n     */\n    isLoggedIn(callback) {\n      if (arguments.length === 0) {\n        return currentUser.hasOwnProperty('role');\n      }\n\n      return Auth.getCurrentUser(null)\n        .then(user => {\n          var is = user.hasOwnProperty('role');\n          safeCb(callback)(is);\n          return is;\n        });\n    },\n\n     /**\n      * Check if a user has a specified role or higher\n      *   (synchronous|asynchronous)\n      *\n      * @param  {String}     role     - the role to check against\n      * @param  {Function|*} callback - optional, function(has)\n      * @return {Bool|Promise}\n      */\n    hasRole(role, callback) {\n      var hasRole = function(r, h) {\n        return userRoles.indexOf(r) >= userRoles.indexOf(h);\n      };\n\n      if (arguments.length < 2) {\n        return hasRole(currentUser.role, role);\n      }\n\n      return Auth.getCurrentUser(null)\n        .then(user => {\n          var has = (user.hasOwnProperty('role')) ?\n            hasRole(user.role, role) : false;\n          safeCb(callback)(has);\n          return has;\n        });\n    },\n\n     /**\n      * Check if a user is an admin\n      *   (synchronous|asynchronous)\n      *\n      * @param  {Function|*} callback - optional, function(is)\n      * @return {Bool|Promise}\n      */\n    isAdmin() {\n      return Auth.hasRole\n        .apply(Auth, [].concat.apply(['admin'], arguments));\n    },\n\n    /**\n     * Get auth token\n     *\n     * @return {String} - a token string used for authenticating\n     */\n    getToken() {\n      return $cookies.get('token');\n    }\n  };\n\n  return Auth;\n}\n\nangular.module('chatApp.auth')\n  .factory('Auth', AuthService);\n\n})();\n"]}