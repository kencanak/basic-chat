{"version":3,"sources":["../../../../server/api/user/user.controller.js"],"names":[],"mappings":"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","file":"user.controller.js","sourcesContent":["'use strict';\n\nimport User from './user.model';\nimport passport from 'passport';\nimport config from '../../config/environment';\nimport jwt from 'jsonwebtoken';\n\nfunction validationError(res, statusCode) {\n  statusCode = statusCode || 422;\n  return function(err) {\n    res.status(statusCode).json(err);\n  }\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n/**\n * update socket Id for the particular user\n */\nexport function updateSocketId(req, res)\n{\n  var socketId = req.user.socketId;\n  var id = req.user._id;\n\n  return User.findById(id).exec()\n    .then(user => {\n      user.socketId = socketId;\n      return user.save()\n        .then(() => {\n          res.status(204).end();\n        })\n        .catch(validationError(res));\n    });\n}\n\n/**\n * Get list of users\n * restriction: 'admin'\n */\nexport function index(req, res) {\n  return User.find({}, '-salt -password').exec()\n    .then(users => {\n      res.status(200).json(users);\n    })\n    .catch(handleError(res));\n}\n\n/**\n * Get list of users based on usernames\n */\n export function contactsListDetails(req, res){\n   var contacts = req.params.contacts.split(\",\");\n   return User.find({userName:{$in: contacts}}, '-salt -password -contacts').exec()\n      .then(contacts => {\n        res.status(200).json({data:contacts});\n      })\n      .catch(handleError(res));\n }\n\n /**\n  * get list of users based on keywords search\n  */\n\n export function findUserByUserName(req, res){\n   var keyword = new RegExp(\"^\" + req.params.keyword, \"gi\");\n   var page = (Number(req.params.page) - 1) * 5;\n   var currentUser = req.user.userName;\n\n   var queryContructor = {\n     $or:\n      [\n        {\n          userName:{\n            $regex: keyword\n          }\n        },\n        {\n          name:{\n            $regex: keyword\n          }\n        }\n      ],\n      userName:{\n        $nin:currentUser\n      }\n    };\n\n   return User.find(queryContructor, '-salt -password -contacts').exec()\n    .then(usersTotal => {\n      return User.find(queryContructor, '-salt -password -contacts').skip(page).limit(5).sort({userName:1, name: 1}).exec()\n       .then(users => {\n         res.status(200).json({data:users, total: usersTotal.length});\n       })\n       .catch(handleError(res));\n\n    })\n    .catch(handleError(res));\n }\n\n /**\n  * add user contacts' list\n  */\nexport function addContactsList(req,res){\n  var contact = req.params.contact;\n  var id = req.params.id;\n\n  return User.findById(id).exec()\n    .then(user => {\n      user.contacts.push(contact);\n      return user.save()\n        .then(() => {\n          res.status(204).end();\n        })\n        .catch(validationError(res));\n    });\n}\n\n/**\n * delete user contacts' list\n */\nexport function deleteContactsList(req,res){\n var contact = req.params.contact;\n var id = req.params.id;\n\n return User.findById(id).exec()\n   .then(user => {\n     var index = user.contacts.indexOf(contact);\n     user.contacts.splice(index,1);\n     return user.save()\n       .then(() => {\n         res.status(204).end();\n       })\n       .catch(validationError(res));\n   });\n}\n\n/**\n * update status\n */\nexport function updateStatus(req,res){\n var status = req.params.status;\n var id = req.params.id;\n\n return User.findById(id).exec()\n   .then(user => {\n     user.status = status;\n     return user.save()\n       .then(() => {\n         res.status(204).end();\n       })\n       .catch(validationError(res));\n   });\n}\n\n\n/**\n * Creates a new user\n */\nexport function create(req, res, next) {\n  var newUser = new User(req.body);\n  newUser.provider = 'local';\n  newUser.role = 'user';\n  newUser.save()\n    .then(function(user) {\n      var token = jwt.sign({ _id: user._id }, config.secrets.session, {\n        expiresIn: 60 * 60 * 5\n      });\n      res.json({ token });\n    })\n    .catch(validationError(res));\n}\n\n/**\n * Get a single user\n */\nexport function show(req, res, next) {\n  var userId = req.params.id;\n\n  return User.findById(userId).exec()\n    .then(user => {\n      if (!user) {\n        return res.status(404).end();\n      }\n      res.json(user.profile);\n    })\n    .catch(err => next(err));\n}\n\n/**\n * Deletes a user\n * restriction: 'admin'\n */\nexport function destroy(req, res) {\n  return User.findByIdAndRemove(req.params.id).exec()\n    .then(function() {\n      res.status(204).end();\n    })\n    .catch(handleError(res));\n}\n\n/**\n * Change a users password\n */\nexport function changePassword(req, res, next) {\n  var userId = req.user._id;\n  var oldPass = String(req.body.oldPassword);\n  var newPass = String(req.body.newPassword);\n\n  return User.findById(userId).exec()\n    .then(user => {\n      if (user.authenticate(oldPass)) {\n        user.password = newPass;\n        return user.save()\n          .then(() => {\n            res.status(204).end();\n          })\n          .catch(validationError(res));\n      } else {\n        return res.status(403).end();\n      }\n    });\n}\n\n/**\n * Get my info\n */\nexport function me(req, res, next) {\n  var userId = req.user._id;\n\n  return User.findOne({ _id: userId }, '-salt -password').exec()\n    .then(user => { // don't ever give out the password or salt\n      if (!user) {\n        return res.status(401).end();\n      }\n      res.json(user);\n    })\n    .catch(err => next(err));\n}\n\n/**\n * Authentication callback\n */\nexport function authCallback(req, res, next) {\n  res.redirect('/');\n}\n"]}