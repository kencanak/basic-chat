{"version":3,"sources":["../../../../server/api/user/user.socket.js"],"names":[],"mappings":";;;;AAIA;;;;;QAKgB,Q,GAAA,Q;;AAHhB;;;;AACA;;;;;;AAEO,SAAS,QAAT,CAAkB,MAAlB,EAA0B;AAC/B,MAAI,SAAS;AACX,YAAO;AACL,kBAAY,OAAO,EADd;AAEL,aAAO,OAAO,aAAP,CAAqB;AAFvB;AADI,GAAb;;;AAQA,iBAAe,MAAf;;AAEA,SAAO,SAAP,CAAiB,IAAjB,CAAsB,aAAtB,EAAqC,OAAO,aAAP,CAAqB,QAA1D;;AAEA,SAAO,EAAP,CAAU,YAAV,EAAwB,YAAU;AAChC,mBAAe,MAAf;AACD,GAFD;AAGD;;AAED,SAAS,cAAT,CAAwB,GAAxB,EACA;AACE,MAAI,WAAW,IAAI,IAAJ,CAAS,QAAxB;AACA,MAAI,KAAK,IAAI,IAAJ,CAAS,GAAlB;;AAEA,iBAAK,QAAL,CAAc,EAAd,EAAkB,IAAlB,GACG,IADH,CACQ,gBAAQ;AACZ,SAAK,QAAL,GAAgB,QAAhB;AACA,WAAO,KAAK,IAAL,GACJ,IADI,CACC,YAAM;AACV,aAAO,IAAP;AACD,KAHI,EAIJ,KAJI,CAIE,eAAO;AACZ,cAAQ,GAAR,CAAY,GAAZ;AACD,KANI,CAAP;AAOD,GAVH;AAWD","file":"user.socket.js","sourcesContent":["/**\n * Broadcast updates to client\n */\n\n'use strict';\n\nimport UserEvents from './user.events';\nimport User from './user.model';\n\nexport function register(socket) {\n  var params = {\n    \"user\":{\n      \"socketId\": socket.id,\n      \"_id\": socket.decoded_token._id\n    }\n  };\n\n  //on connected let's update the socket ID\n  updateSocketId(params);\n  //broadcast some one is online\n  socket.broadcast.emit('User Online', socket.decoded_token.userName);\n\n  socket.on('disconnect', function(){\n    updateSocketId(params);\n  });\n}\n\nfunction updateSocketId(req)\n{\n  var socketId = req.user.socketId;\n  var id = req.user._id;\n\n  User.findById(id).exec()\n    .then(user => {\n      user.socketId = socketId;\n      return user.save()\n        .then(() => {\n          return true;\n        })\n        .catch(err => {\n          console.log(err);\n        });\n    });\n}\n"]}